<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title></title>

        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/highlight.dark.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="/">
                The title
                <small class="hidden-xs hidden-sm">
                    This is the default subtitle!
                </small>
            </a>

            
        </header>

        <main class="container">
            <div class="row">

                
                <section id="content" class="col-sm-12">
                    <h1 id="introduction">Introduction</h1>
<p>Tabular is a PHP library for generating table data structures (e.g. an
invoice, a report) from an XML data source.</p>
<p>It allows you to:</p>
<ul>
<li>Define a configuration which dynamically creates table <em>rows</em> composed of
<em>cells</em>. </li>
<li>Evaluate values dynamically using <em>extended</em> XPath expressions.</li>
<li>Tokenize expressions, literal values and cell names, and iterate over sets
of parameters.</li>
<li>Assign rows (or sets of rows) to groups, which can be targeted in subsequent
passes.</li>
<li>Format cells using pre-configured and custom formatters.</li>
<li>Define parameters which can be passed at the time of generation.</li>
</ul>
<p>It aims to be functionally equivalent to a spreadsheet.</p>
<p>It accepts a source XML document and a Tabular JSON definition file, it gives
back an XML file structured as a table which can then be used in anyway you
would like.</p>
<h2 id="why">Why?</h2>
<p>You could generate tabular data only with PHP, but as anybody who has ever
tried this can testify this results in a nightmare of variables and spaghetti
code.</p>
<p>You could do generate reports with XSLT transformations, but I think this is hugely
verbose and detached from the familiar PHP environment.</p>
<h2 id="how">How?</h2>
<p>The central concept is the definition file:</p>
<pre><code class="language-javascript">{
    "rows": [
        {
            "cells": [
                {
                    "name": "title",
                    "expr": "string(./title)"
                },
                {
                    "name": "price",
                    "expr": "number(./price)"
                }
            ],
            "with_query": "//book"
        },
        {
            "cells": [
                {
                    "name": "price",
                    "expr": "sum(//price)"
                }
            ]
        }
    ]
}</code></pre>
<p>The above definition will generate a table representation in XML with a row
for each <code>&lt;book/&gt;</code> element in the given XML file and provide an additional row
showing the sum of all the <code>&lt;price/&gt;</code> elements of the <code>&lt;book/&gt;</code> element.</p>
<p>So given the following XML file:</p>
<pre><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;store&gt;
    &lt;book&gt;
        &lt;title&gt;War and Peace&lt;/title&gt;
        &lt;price&gt;5.00&lt;/price&gt;
    &lt;/book&gt;
    &lt;book&gt;
        &lt;title&gt;One Hundered Years of Soliture&lt;/title&gt;
        &lt;price&gt;7&lt;/price&gt;
    &lt;/book&gt;
&lt;/store&gt;</code></pre>
<p>We can generate an array of tabular data as follows:</p>
<pre><code class="language-php">use PhpBench\Tabular\Tabular;

$dom = new DomDocument('1.0');
$dom-&gt;load('books.xml');

// report.json contains the above JSON definition
$tableDom = Tabular::getInstance()-&gt;tabulate($dom, 'report.json');</code></pre>
<p>We can then either iterate the table data with an XPath query:</p>
<pre><code class="language-php">foreach ($tableDom-&gt;xpath()-&gt;query('//row') as $rowEl) {
    foreach ($tableDom-&gt;xpath()-&gt;query('.//cell', $rowEl) as $cellEl) {
        $value = $cellEl-&gt;nodeValue;
    }
}</code></pre>
<p>or dump it as an array</p>
<pre><code class="language-php">$rows = $tableDom-&gt;toArray();</code></pre>
                </section>

            </div>
        </main>

        <footer>
            <div class="container">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
